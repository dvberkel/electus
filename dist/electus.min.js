/*! electus - v0.0.0-2 - 2012-12-12
* https://github.com/dvberkel/electus
* Copyright (c) 2012 Daan van Berkel; Licensed MIT */
(function(e){"use strict";e.Electus={version:"0.0.0"}})(window?window:module.exports),function(e,t,n,r){var i=n.Model.extend({defaults:{text:"Empty sentence"},initialize:function(){this.has("after-send")||this.set("after-send",[])},send:function(){var e=this;t.each(this.get("after-send"),function(t){t.call(e)})}}),s=n.Collection.extend({model:i,initialize:function(e){e=e||{},e["after-send"]?this["after-send"]=e["after-send"]:this["after-send"]=[]},addAll:function(e){this.reset();var n=e.split(";"),r=this;t.each(n,function(e){var t=new i({text:e,"after-send":[function(){r.send(this)}]});this.add(t)},this)},send:function(e){t.each(this["after-send"],function(t){t.call(e)})}}),o=n.View.extend({initialize:function(){this.model.on("change:text",this.render,this),this.render()},render:function(){var e=this.span();e.text(this.model.get("text"))},span:function(){return this._span||(this._span=e("<h1 class='sentence'>?</h1>"),this._span.appendTo(this.$el)),this._span}}),u=n.View.extend({initialize:function(){this.model.on("add",this.render,this),this.render()},render:function(){this.$el.empty();var t=e('<table class="sentences table table-striped table-bordered table-condensed"></table>');this.model.each(function(e){new a({model:e,el:t})}),t.appendTo(this.$el),new l({model:this.model,el:this.$el})}}),a=n.View.extend({template:t.template("<td><%= text %></td>"),initialize:function(){this.render()},render:function(){var t=e("<tr></tr>");e(this.template(this.model.toJSON())).appendTo(t),new f({model:this.model,el:t}),t.appendTo(this.$el)}}),f=n.View.extend({initialize:function(){this.render()},render:function(){var t=this,n=this.button();n.click(function(){t.model.send(),n.hide()});var r=e("<td></td>");n.appendTo(r),r.appendTo(this.$el)},button:function(){return this._button===undefined&&(this._button=e("<button class='send btn btn-success'>send</button>")),this._button}}),l=n.View.extend({initialize:function(){this.render()},render:function(){var t=this,n=e("<textarea></textarea>");n.appendTo(this.$el);var r=e("<button class='upload btn btn-success'>upload</button>");r.click(function(){t.model.addAll(n.val())}),r.appendTo(this.$el)}});r.Sentence=i,r.Sentences=s,r.SentenceView=o,r.SentencesView=u}(jQuery,_,Backbone,Electus),function(e,t,n,r,i){var s=n.Model.extend({initialize:function(){this.has("sentence")||this.set("sentence",new r.Sentence({text:"You should come prepared"})),this.get("sentence").on("change:text",function(){this.trigger("change:sentence")},this)},agree:function(){this.set("agreement",!0)},disagree:function(){this.set("agreement",!1)},setSentence:function(e){this.get("sentence").set("text",e),this.set("agreement",i,{silent:!0})}}),o=n.View.extend({initialize:function(){this.render()},render:function(){var t=e("<div class='statement'></div>");new r.SentenceView({model:this.model.get("sentence"),el:t}),new u({model:this.model,el:t}),new a({model:this.model,el:t}),t.appendTo(this.$el)}}),u=n.View.extend({initialize:function(){this.model.on("change:sentence",function(){this.button().show()},this),this.model.on("change:agreement",function(){this.button().hide()},this),this.render()},render:function(){var e=this,t=this.button();t.click(function(){e.model.agree()})},button:function(){return this._button===i&&(this._button=e("<button class='agree btn btn-large btn-success'>agree</button>"),this._button.appendTo(this.$el),this.model.get("agreement")!==i&&this._button.hide()),this._button}}),a=n.View.extend({initialize:function(){this.model.on("change:sentence",function(){this.button().show()},this),this.model.on("change:agreement",function(){this.button().hide()},this),this.render()},render:function(){var e=this,t=this.button();t.click(function(){e.model.disagree()})},button:function(){return this._button===i&&(this._button=e("<button class='disagree btn btn-large btn-danger'>disagree</button>"),this._button.appendTo(this.$el),this.model.get("agreement")!==i&&this._button.hide()),this._button}});r.Statement=s,r.StatementView=o}(jQuery,_,Backbone,Electus),function(e,t,n,r,i){var s=n.Model.extend({defaults:{_agreements:0,_disagreements:0},agreements:function(){return this.get("_agreements")},disagreements:function(){return this.get("_disagreements")},agreement:function(e){e===!0&&this.set("_agreements",this.get("_agreements")+1),e===!1&&this.set("_disagreements",this.get("_disagreements")+1)},votes:function(){return this.agreements()+this.disagreements()}}),o=n.Collection.extend({model:s,addAgreements:function(e,t){var n=this.agreementWithText(e);n===i&&(n=new s({sentence:new r.Sentence({text:e})}),this.add(n)),n.agreement(t)},agreementWithText:function(e){var t;return this.each(function(n){n.get("sentence").get("text")===e&&(t=n)}),t}}),u=n.View.extend({initialize:function(){this.render(),this.model.on("add",this.render,this)},render:function(){this.$el.empty();var t=e("<table class='agreements table table-striped table-bordered table-condensed'></table>");t.append(e("<tr></tr>").append(e("<td><i class='icon-thumbs-up'></i></td><td>Statement</td><td>Votes</td><td><i class='icon-thumbs-down'></i></td>"))),this.model.each(function(e){new a({model:e,el:t})}),t.appendTo(this.$el)}}),a=n.View.extend({initialize:function(){this.render()},render:function(){var t=e("<tr class='agreement'></tr>");new f({model:this.model,el:t}),new l({model:this.model,el:t}),new c({model:this.model,el:t}),new h({model:this.model,el:t}),t.appendTo(this.$el)}}),f=n.View.extend({initialize:function(){this.render(),this.model.on("change:_agreements",this.render,this)},render:function(){var e=this.td();e.html(this.model.agreements())},td:function(){return this._td===i&&(this._td=e("<td class='up'></td>"),this._td.appendTo(this.$el)),this._td}}),l=n.View.extend({initialize:function(){this.render()},render:function(){var t=e("<td class='sentence'></td>");t.append(this.model.get("sentence").get("text")),t.appendTo(this.$el)}}),c=n.View.extend({initialize:function(){this.render(),this.model.on("change",this.render,this)},render:function(){var e=this.td();e.html(this.model.votes())},td:function(){return this._td===i&&(this._td=e("<td class='votes'></td>"),this._td.appendTo(this.$el)),this._td}}),h=n.View.extend({initialize:function(){this.render(),this.model.on("change:_disagreements",this.render,this)},render:function(){var e=this.td();e.html(this.model.disagreements())},td:function(){return this._td===i&&(this._td=e("<td class='down'></td>"),this._td.appendTo(this.$el)),this._td}});r.Agreement=s,r.Agreements=o,r.AgreementsView=u}(jQuery,_,Backbone,Electus);